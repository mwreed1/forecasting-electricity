---
title: "EDA"
author: "Margaret Reed"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)
```

```{r load-pkgs}
library(tidyverse)
library(lubridate)
```


```{r load-data}
data <- read_csv("../raw_data/weekly_usage.csv")
```
## Exploratory data analysis

### data cleaning

To clean the data, all that was really required was creating a date object with the year and week variables.

```{r clean-data}
data <- data %>%
  mutate(
    date = lubridate::parse_date_time(paste(year, week, 1, sep="/"),'Y/W/w')
  ) %>%
  select(date, account, value, t)
```

### plotting the data

First I plotted the data as it was. 


```{r plot-data}
data %>%
   ggplot(aes(x = date, y = value)) +
   geom_point() +
  theme_minimal()
```


It looks pretty messy but there are clearly several different trends within the data.

### finding trends

To get a better look at these trends I decided to look at the 5 top consumers of electricity among the different accounts

```{r explore-data}
top_5_accounts <- data %>%
  group_by(account) %>%
  summarize(
    total_val = sum(value)
  ) %>%
  arrange(desc(total_val)) %>%
  slice(1:5) %>%
  pull(account)

data %>%
  filter(
    account %in% top_5_accounts
  ) %>%
   ggplot(aes(x = date, y = value, color = account)) +
   geom_line() +
  theme_minimal()
```


Clearly accounts MT_362, _196, _279, _370, and _208 are the top users and have fairly defined trends with seasonal components. 
